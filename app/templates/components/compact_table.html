<!-- Combined Data Range & Table Settings Header -->
<div
    class="mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4 p-4 bg-card-warm dark:bg-terminal-surface rounded-xl border border-brand-black-60/20 dark:border-white/10 font-ui">
    <!-- LEFT: Data Range Selector -->
    <div class="flex flex-wrap items-center gap-3">
        <div class="flex items-center gap-2"
            title="Ranges filter displayed observations only. Metrics are based on available data points, not calendar periods.">
            <svg class="w-4 h-4 text-brand-black-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <span class="text-xs font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60">Display
                Range</span>
        </div>
        <div class="flex items-center gap-1 p-1 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
            <button onclick="setDataRange('1W')" id="range-1W" aria-label="Show last 1 week of available observations"
                class="range-btn min-h-[44px] px-3 sm:px-4 text-xs font-bold rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-brand-oxford dark:focus:ring-brand-teal">1W</button>
            <button onclick="setDataRange('1M')" id="range-1M" aria-label="Show last 1 month of available observations"
                class="range-btn min-h-[44px] px-3 sm:px-4 text-xs font-bold rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-brand-oxford dark:focus:ring-brand-teal">1M</button>
            <button onclick="setDataRange('3M')" id="range-3M" aria-label="Show last 3 months of available observations"
                class="range-btn min-h-[44px] px-3 sm:px-4 text-xs font-bold rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-brand-oxford dark:focus:ring-brand-teal">3M</button>
            <button onclick="setDataRange('6M')" id="range-6M" aria-label="Show last 6 months of available observations"
                class="range-btn min-h-[44px] px-3 sm:px-4 text-xs font-bold rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-brand-oxford dark:focus:ring-brand-teal">6M</button>
            <button onclick="setDataRange('1Y')" id="range-1Y" aria-label="Show last 1 year of available observations"
                class="range-btn min-h-[44px] px-3 sm:px-4 text-xs font-bold rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-brand-oxford dark:focus:ring-brand-teal">1Y</button>
            <button onclick="setDataRange('ALL')" id="range-ALL" aria-label="Show all data"
                class="range-btn min-h-[44px] px-3 sm:px-4 text-xs font-bold rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-brand-oxford dark:focus:ring-brand-teal">ALL</button>
        </div>
        <div class="text-xs text-brand-black-60 dark:text-brand-black-60">
            <span class="font-medium">Showing:</span>
            <span id="date-range-display" class="font-bold text-brand-black-80 dark:text-white ml-1">All available
                data</span>
        </div>
    </div>

    <!-- RIGHT: Table Configuration Toggle -->
    <div class="flex items-center gap-3 shrink-0 border-l border-brand-black-60/10 dark:border-white/10 pl-4 md:pl-6">
        <div class="flex items-center gap-2">
            <svg class="w-4 h-4 text-brand-black-60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                </path>
            </svg>
            <span class="text-xs font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60">Settings</span>
        </div>
        <button onclick="toggleSettingsPanel()" id="settings-toggle-btn"
            class="text-xs font-bold text-brand-oxford dark:text-brand-teal hover:underline">
            <span id="settings-toggle-text">Show</span>
        </button>
    </div>
</div>

<!-- Table Settings Panel -->
<div id="table-settings-container"
    class="mb-6 bg-card-warm dark:bg-terminal-surface rounded-xl border border-brand-black-60/20 dark:border-white/10 overflow-hidden hidden">

    <!-- Settings Content (Hidden by default) -->
    <div id="settings-panel" class="hidden">
        <div class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">

            <!-- COMMODITY Column Settings -->
            <div class="p-4 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="col-commodity" checked onchange="toggleColumn('commodity')"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-sm font-bold text-brand-black-80 dark:text-white font-ui">Commodity</span>
                    </div>
                </div>
                <!-- Live Preview -->
                <div
                    class="mb-3 p-3 bg-white dark:bg-terminal-black rounded-lg border border-brand-black-60/10 dark:border-white/10">
                    <div class="text-[9px] font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60 mb-2">
                        Preview</div>
                    <div id="preview-commodity" class="flex items-center gap-2">
                        <div
                            class="w-8 h-8 rounded-lg bg-brand-black-60/10 dark:bg-white/10 flex items-center justify-center">
                            <span class="text-[9px] font-bold text-brand-black-60">BR</span>
                        </div>
                        <div>
                            <div class="text-xs font-bold text-brand-black-80 dark:text-white">Brent Crude Oil</div>
                            <div class="text-[9px] text-brand-black-60">Energy</div>
                        </div>
                    </div>
                </div>
                <div class="space-y-2 text-xs font-ui">
                    <div>
                        <label
                            class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Display</label>
                        <select id="commodity-display" onchange="updatePreview('commodity')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="full">Name + Category + Icon</option>
                            <option value="name-category">Name + Category</option>
                            <option value="name-only">Name Only</option>
                            <option value="compact">Icon + Name</option>
                        </select>
                    </div>
                    <label class="flex items-center gap-2 cursor-pointer mt-2" title="D = Daily data, M = Monthly data">
                        <input type="checkbox" id="table-show-freq-badge" checked onchange="toggleFreqBadge()"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-xs font-medium text-brand-black-80 dark:text-white">Freq. Badge (D/M)</span>
                    </label>
                </div>
            </div>

            <!-- TREND Column Settings -->
            <div class="p-4 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="col-trend" checked onchange="toggleColumn('trend')"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-sm font-bold text-brand-black-80 dark:text-white font-ui">Recent</span>
                    </div>
                </div>
                <!-- Live Preview -->
                <div
                    class="mb-3 p-3 bg-white dark:bg-terminal-black rounded-lg border border-brand-black-60/10 dark:border-white/10">
                    <div class="text-[9px] font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60 mb-2">
                        Preview</div>
                    <div id="preview-trend"
                        class="h-8 flex items-center justify-center text-brand-oxford dark:text-brand-teal">
                        <svg class="w-full h-6" viewBox="0 0 100 24">
                            <defs>
                                <linearGradient id="sparkGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" stop-color="currentColor" stop-opacity="0.3" />
                                    <stop offset="100%" stop-color="currentColor" stop-opacity="0" />
                                </linearGradient>
                            </defs>
                            <path id="preview-trend-fill"
                                d="M0,20 L10,18 L25,12 L40,15 L55,8 L70,10 L85,4 L100,6 L100,24 L0,24 Z"
                                fill="url(#sparkGrad)" />
                            <path id="preview-trend-line" d="M0,20 L10,18 L25,12 L40,15 L55,8 L70,10 L85,4 L100,6"
                                fill="none" stroke="currentColor" stroke-width="2" />
                        </svg>
                    </div>
                </div>
                <div class="space-y-2 text-xs font-ui">
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Chart
                            Type</label>
                        <select id="trend-type" onchange="updatePreview('trend')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="area">Area Chart</option>
                            <option value="line">Line Chart</option>
                            <option value="bar">Bar Chart</option>
                            <option value="step">Step Chart</option>
                            <option value="sparkline-range">Sparkline + Range</option>
                            <option value="none">Hide Chart</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Data
                            Points</label>
                        <select id="trend-points" onchange="updatePreview('trend')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="7">Last 7 days</option>
                            <option value="15">Last 15 days</option>
                            <option value="30" selected>Last 30 days</option>
                            <option value="90">Last 90 days</option>
                            <option value="180">Last 180 days</option>
                            <option value="365">Last 365 days</option>
                            <option value="all">All available</option>
                        </select>
                    </div>
                    <div class="pt-2 border-t border-brand-black-60/10 dark:border-white/10">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="trend-ma" onchange="updatePreview('trend')"
                                class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                            <span class="text-[10px] font-bold text-brand-black-60 tracking-wider">Show 7-Day
                                Moving Avg</span>
                        </label>
                    </div>
                    <div>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="trend-highlow" onchange="updatePreview('trend')"
                                class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                            <span class="text-[10px] font-bold text-brand-black-60 tracking-wider">Show
                                High/Low Markers</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- PRICE Column Settings -->
            <div class="p-4 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="col-price" checked onchange="toggleColumn('price')"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-sm font-bold text-brand-black-80 dark:text-white font-ui">Price</span>
                    </div>
                </div>
                <!-- Live Preview -->
                <div
                    class="mb-3 p-3 bg-white dark:bg-terminal-black rounded-lg border border-brand-black-60/10 dark:border-white/10">
                    <div class="text-[9px] font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60 mb-2">
                        Preview</div>
                    <div id="preview-price" class="text-right">
                        <div class="text-sm font-bold text-brand-black-80 dark:text-white">2,328.23</div>
                        <div class="text-[9px] text-brand-black-60">USD</div>
                    </div>
                </div>
                <div class="space-y-2 text-xs font-ui">
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Number
                            Format</label>
                        <select id="price-format" onchange="updatePreview('price')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="default">Default (89.84)</option>
                            <option value="thousands">Thousands (2,328.23)</option>
                            <option value="compact">Compact (2.3K)</option>
                        </select>
                    </div>
                    <div>
                        <label
                            class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Currency</label>
                        <select id="price-currency" onchange="updatePreview('price')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="below">Below Price</option>
                            <option value="inline">Inline (USD 89.84)</option>
                            <option value="symbol">Symbol ($89.84)</option>
                            <option value="none">Hide Currency</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Decimal
                            Precision</label>
                        <select id="price-precision" onchange="updatePreview('price')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="2" selected>2 decimals (63.00)</option>
                            <option value="3">3 decimals (63.000)</option>
                            <option value="4">4 decimals (63.0000)</option>
                            <option value="0">No decimals (63)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- CHANGE Column Settings -->
            <div class="p-4 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="col-chg" checked onchange="toggleColumn('chg')"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-sm font-bold text-brand-black-80 dark:text-white font-ui">Change (Abs)</span>
                    </div>
                </div>
                <!-- Live Preview -->
                <div
                    class="mb-3 p-3 bg-white dark:bg-terminal-black rounded-lg border border-brand-black-60/10 dark:border-white/10">
                    <div class="text-[9px] font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60 mb-2">
                        Preview</div>
                    <div id="preview-chg" class="flex items-center justify-end gap-1">
                        <span class="text-sm font-bold text-brand-teal">▲ +12.45</span>
                    </div>
                </div>
                <div class="space-y-2 text-xs font-ui">
                    <div>
                        <label
                            class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Display</label>
                        <select id="chg-format" onchange="updatePreview('chg')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="arrow">With Arrow (▲ +0.65)</option>
                            <option value="sign">Sign Only (+0.65)</option>
                            <option value="plain">Plain (0.65)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Color</label>
                        <select id="chg-color" onchange="updatePreview('chg')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="colored">Green/Red</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- PERCENT CHANGE Column Settings -->
            <div class="p-4 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="col-pct" checked onchange="toggleColumn('pct')"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-sm font-bold text-brand-black-80 dark:text-white font-ui">Change (%)</span>
                    </div>
                </div>
                <!-- Live Preview -->
                <div
                    class="mb-3 p-3 bg-white dark:bg-terminal-black rounded-lg border border-brand-black-60/10 dark:border-white/10">
                    <div class="text-[9px] font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60 mb-2">
                        Preview</div>
                    <div id="preview-pct" class="flex justify-end">
                        <span
                            class="px-2 py-0.5 rounded text-xs font-bold bg-brand-teal/10 text-brand-teal">+0.72%</span>
                    </div>
                </div>
                <div class="space-y-2 text-xs font-ui">
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Style</label>
                        <select id="pct-style" onchange="updatePreview('pct')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="badge">Badge Style</option>
                            <option value="plain">Plain Text</option>
                        </select>
                    </div>
                    <div>
                        <label
                            class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Decimals</label>
                        <select id="pct-decimals" onchange="updatePreview('pct')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="0">0 (-1%)</option>
                            <option value="1">1 (-0.7%)</option>
                            <option value="2" selected>2 (-0.72%)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- UPDATED Column Settings -->
            <div class="p-4 bg-brand-black-60/5 dark:bg-white/5 rounded-xl">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="col-updated" checked onchange="toggleColumn('updated')"
                            class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                        <span class="text-sm font-bold text-brand-black-80 dark:text-white font-ui">Updated</span>
                    </div>
                </div>
                <!-- Live Preview -->
                <div
                    class="mb-3 p-3 bg-white dark:bg-terminal-black rounded-lg border border-brand-black-60/10 dark:border-white/10">
                    <div class="text-[9px] font-bold tracking-wider text-brand-black-60 dark:text-brand-black-60 mb-2">
                        Preview</div>
                    <div id="preview-updated" class="text-right">
                        <span class="text-xs font-medium text-brand-black-60">2026-01-07</span>
                    </div>
                </div>
                <div class="space-y-2 text-xs font-ui">
                    <div>
                        <label class="block text-[9px] font-bold tracking-wider text-brand-black-60 mb-1">Date
                            Format</label>
                        <select id="updated-format" onchange="updatePreview('updated')"
                            class="w-full px-2 py-1.5 text-xs bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg text-brand-black-80 dark:text-white">
                            <option value="iso">ISO (2026-01-07)</option>
                            <option value="short">Short (Jan 7)</option>
                            <option value="long">Long (January 7, 2026)</option>
                            <option value="relative">Relative (Today)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Column Options -->
        <div class="px-4 py-3 border-t border-brand-black-60/10 dark:border-white/5">
            <div class="text-[9px] font-bold tracking-wider text-brand-black-60 mb-2">Additional Columns</div>
            <div class="flex flex-wrap gap-3">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="col-source" onchange="toggleColumn('source')"
                        class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                    <span class="text-xs font-bold text-brand-black-60">Data Source</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="col-ytd" onchange="toggleColumn('ytd')"
                        class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                    <span class="text-xs font-bold text-brand-black-60">YTD Change</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" id="col-range" onchange="toggleColumn('range')"
                        class="w-4 h-4 rounded border-brand-black-60/30 text-brand-oxford focus:ring-brand-oxford">
                    <span class="text-xs font-bold text-brand-black-60">52-Week Range</span>
                </label>
            </div>
        </div>

        <!-- Settings Footer -->
        <div
            class="px-4 py-3 bg-brand-black-60/5 dark:bg-white/5 border-t border-brand-black-60/10 dark:border-white/5 flex items-center justify-between">
            <div class="text-xs text-brand-black-60 dark:text-brand-black-60 font-ui">
                <span id="visible-columns-count">6</span>/9 columns visible
            </div>
            <div class="flex items-center gap-2">
                <button onclick="exportToCSV()"
                    class="px-4 py-2 text-xs font-bold text-brand-oxford dark:text-brand-teal hover:opacity-80 bg-brand-oxford/10 dark:bg-brand-teal/10 border border-brand-oxford/20 dark:border-brand-teal/20 rounded-lg transition-all font-ui flex items-center gap-1.5">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    Export CSV
                </button>
                <button onclick="resetAllSettings()"
                    class="px-4 py-2 text-xs font-bold text-brand-black-60 hover:text-brand-black-80 dark:hover:text-white bg-white dark:bg-terminal-black border border-brand-black-60/20 dark:border-white/10 rounded-lg transition-all font-ui">
                    Reset Defaults
                </button>
                <button onclick="applySettings()"
                    class="px-4 py-2 text-xs font-bold text-white bg-brand-black-80 dark:bg-white dark:text-terminal-black rounded-lg transition-all hover:opacity-90 font-ui">
                    Apply Changes
                </button>
            </div>
        </div>
    </div>
</div>

<div class="relative">
    <div id="table-loading" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse font-ui" id="data-table">
            <thead class="bg-brand-black-60/5 dark:bg-white/5 border-y border-brand-black-60/20 dark:border-white/10">
                <tr>
                    <th data-col="commodity" data-sort="name" scope="col" onclick="sortTable('name')"
                        class="px-4 py-4 text-[10px] font-bold tracking-wider text-brand-black-60 cursor-pointer hover:bg-brand-black-60/10 dark:hover:bg-white/10 transition-colors select-none">
                        <span class="flex items-center gap-1">Commodity <span
                                class="sort-indicator text-brand-oxford dark:text-brand-teal"
                                data-sort="name"></span></span>
                    </th>
                    <th data-col="trend" scope="col"
                        class="px-4 py-4 text-[10px] font-bold tracking-wider text-brand-black-60 w-32">Recent
                    </th>
                    <th data-col="price" data-sort="price" scope="col" onclick="sortTable('price')"
                        class="px-4 py-4 text-[10px] font-bold tracking-wider text-brand-black-60 text-right cursor-pointer hover:bg-brand-black-60/10 dark:hover:bg-white/10 transition-colors select-none">
                        <span class="flex items-center justify-end gap-1">Price <span
                                class="sort-indicator text-brand-oxford dark:text-brand-teal"
                                data-sort="price"></span></span>
                    </th>
                    <th data-col="chg" data-sort="change" scope="col" onclick="sortTable('change')"
                        class="px-4 py-4 text-[10px] font-bold tracking-wider text-brand-black-60 text-right cursor-pointer hover:bg-brand-black-60/10 dark:hover:bg-white/10 transition-colors select-none">
                        <span class="flex items-center justify-end gap-1">Chg <span
                                class="sort-indicator text-brand-oxford dark:text-brand-teal"
                                data-sort="change"></span></span>
                    </th>
                    <th data-col="pct" data-sort="pct" scope="col" onclick="sortTable('pct')"
                        class="px-4 py-4 text-[10px] font-bold tracking-wider text-brand-black-60 text-right cursor-pointer hover:bg-brand-black-60/10 dark:hover:bg-white/10 transition-colors select-none">
                        <span class="flex items-center justify-end gap-1">%Chg <span
                                class="sort-indicator text-brand-oxford dark:text-brand-teal"
                                data-sort="pct"></span></span>
                    </th>
                    <th data-col="updated" data-sort="date" scope="col" onclick="sortTable('date')"
                        class="px-4 py-4 text-[10px] font-bold tracking-wider text-brand-black-60 text-right cursor-pointer hover:bg-brand-black-60/10 dark:hover:bg-white/10 transition-colors select-none">
                        <span class="flex items-center justify-end gap-1">Updated <span
                                class="sort-indicator text-brand-oxford dark:text-brand-teal"
                                data-sort="date"></span></span>
                    </th>
                </tr>
            </thead>
            <tbody class="divide-y divide-brand-black-60/10 dark:divide-white/5">
                {% for commodity in commodities %}
                <tr onclick="window.location='{{ url_for('main.commodity_detail', commodity_id=commodity.id) }}'"
                    tabindex="0" role="link"
                    onkeydown="if(event.key==='Enter')window.location='{{ url_for('main.commodity_detail', commodity_id=commodity.id) }}'"
                    class="hover:bg-brand-black-60/5 dark:hover:bg-white/5 cursor-pointer transition-all duration-200 group focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brand-oxford dark:focus:ring-brand-teal">
                    <td data-col="commodity" class="px-4 py-5">
                        <div class="flex items-center gap-3 commodity-cell">
                            <div
                                class="commodity-icon w-10 h-10 rounded-xl bg-brand-black-60/5 dark:bg-white/5 flex items-center justify-center group-hover:bg-brand-oxford/10 dark:group-hover:bg-brand-teal/10 transition-colors">
                                <span class="text-[10px] font-bold text-brand-black-60 dark:text-brand-black-60">{{
                                    commodity.id[:2] }}</span>
                            </div>
                            <div>
                                <div
                                    class="commodity-name text-sm font-bold text-brand-black-80 dark:text-white group-hover:text-brand-oxford dark:group-hover:text-brand-teal transition-colors">
                                    {{ commodity.name }}</div>
                                <div class="commodity-category text-[10px] text-brand-black-60 tracking-wide">
                                    {{
                                    commodity.category }}</div>
                            </div>
                        </div>
                    </td>
                    <td data-col="trend" class="px-4 py-5">
                        <div class="h-10 w-28 bg-brand-black-60/5 dark:bg-white/5 rounded-lg p-1">
                            <canvas id="sparkline-{{ commodity.id }}" role="img"
                                aria-label="Price trend sparkline for {{ commodity.name }}"></canvas>
                        </div>
                    </td>
                    <td data-col="price" class="px-4 py-5 text-right">
                        <div class="price-value text-sm font-bold text-brand-black-80 dark:text-white"
                            data-raw="{{ commodity.price }}">{{ commodity.price }}</div>
                        <div class="price-currency text-[10px] text-brand-black-60">{{ commodity.currency }}
                        </div>
                    </td>
                    <td data-col="chg" class="px-4 py-5 text-right">
                        <div class="chg-cell inline-flex items-center gap-1 text-sm font-bold"
                            style="color: var({% if commodity.daily_change|default(commodity.change) >= 0 %}--color-up{% else %}--color-down{% endif %});"
                            data-value="{{ commodity.daily_change|default(commodity.change) }}">
                            <span class="chg-arrow text-[10px]">{% if commodity.daily_change|default(commodity.change)
                                >= 0
                                %}▲{% else %}▼{% endif %}</span>
                            <span class="chg-value">{% if commodity.daily_change|default(commodity.change) >= 0 %}+{%
                                endif
                                %}{{ commodity.daily_change|default(commodity.change) }}</span>
                        </div>
                    </td>
                    <td data-col="pct" class="px-4 py-5 text-right">
                        <div class="pct-cell inline-flex px-2 py-1 rounded-md text-sm font-bold"
                            style="color: var({% if commodity.daily_change|default(commodity.change) >= 0 %}--color-up{% else %}--color-down{% endif %}); background-color: var({% if commodity.daily_change|default(commodity.change) >= 0 %}--color-up-bg{% else %}--color-down-bg{% endif %});"
                            data-value="{{ commodity.daily_change_percent|default(commodity.change_percent) }}">
                            {% if commodity.daily_change|default(commodity.change) >= 0 %}+{% endif %}{{
                            commodity.daily_change_percent|default(commodity.change_percent) }}%
                        </div>
                    </td>
                    <td data-col="updated" class="px-4 py-5 text-right">
                        <div class="updated-cell text-xs font-medium text-brand-black-60"
                            data-raw="{{ commodity.date }}" data-date="{{ commodity.date }}">{{
                            commodity.date }}</div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<!-- Data passed via JSON for external JS -->
<script id="commodities-data" type="application/json">
{{ commodities | tojson }}
</script>

<!-- External JS modules -->
<script src="{{ url_for('static', filename='js/core/settings.js') }}"></script>
<script src="{{ url_for('static', filename='js/core/utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/theme.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/compact_table.js') }}"></script>

<script>
    // Initialize compact table with Jinja2 data
    document.addEventListener('DOMContentLoaded', function () {
        const commodities = JSON.parse(document.getElementById('commodities-data').textContent);
        BW.CompactTable.init(commodities);
    });
</script>